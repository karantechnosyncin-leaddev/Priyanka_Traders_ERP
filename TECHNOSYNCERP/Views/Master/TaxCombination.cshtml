<style>

    /*Table Switch*/
    .tblswitch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 18px;
        padding: 0px !important;
        margin: 0px !important;
    }

        .tblswitch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .tblslider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

        .tblslider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

    .tblswitch input:checked + .tblslider {
        background-color: #2196F3; /* Change color when checked */
    }

        .tblswitch input:checked + .tblslider:before {
            transform: translateX(30px); /* Move the slider knob */
        }
</style>
<div class="container py-2 py-md-3">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title mb-0"><b>Tax Combination Setup</b></h5>
                </div>
                <div class="card-body p-0">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs nav-tabs-custom" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active" id="create-tab" data-bs-toggle="tab" data-bs-target="#create-user" type="button" role="tab" aria-controls="create-user" aria-selected="true">
                                <i class="fas fa-plus-circle me-1"></i> Create Tax Combination
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" id="all-users-tab" data-bs-toggle="tab" data-bs-target="#all-users" type="button" role="tab" aria-controls="all-users" aria-selected="false">
                                <i class="fas fa-list me-1"></i> All Tax Combinations
                            </button>
                        </li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content p-3">
                        <!-- Create Tax Combination Tab -->
                        <div class="tab-pane fade show active" id="create-user" role="tabpanel" aria-labelledby="create-tab">
                            <form id="TaxCombination_Form" class="needs-validation" novalidate>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="IsActive" name="IsActive" checked>
                                            <label class="form-check-label" for="IsActive">Active Status</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="row g-3">
                                    <input type="hidden" name="TaxCodeId" id="TaxCodeId">

                                    <div class="col-md-6 col-lg-3">
                                        <label for="TaxCode" class="form-label">Tax Code <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="TaxCode" name="TaxCode" required>
                                        <div class="invalid-feedback">Please enter a tax code</div>
                                    </div>

                                    <div class="col-md-6 col-lg-3">
                                        <label for="TaxCalRate" class="form-label">Rate</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control text-end" id="TaxCalRate" name="TaxCalRate" readonly>
                                        </div>
                                    </div>

                                    <div class="col-md-6 col-lg-3">
                                        <label for="TaxFormula" class="form-label">Tax Formula</label>
                                        <textarea class="form-control" id="TaxFormula" name="TaxFormula" rows="2"></textarea>
                                    </div>

                                    <div class="col-md-6 col-lg-3">
                                        <div class="form-check form-switch mt-4 pt-1">
                                            <input class="form-check-input" type="checkbox" id="Freight_app" name="Freight_app">
                                            <label class="form-check-label" for="Freight_app">Apply to Freight</label>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-3">
                                        <div class="card">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">Tax Components</h6>
                                            </div>
                                            <div class="card-body p-0">
                                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                                    <table class="table  table-hover mb-0" id="TaxSetuptbl">
                                                        <thead class="bg-light sticky-top">
                                                            <tr>
                                                                <th width="5%" class="text-center">#</th>
                                                                <th width="15%" class="text-center">Actions</th>
                                                                <th class='text-end' width="40%">Code</th>
                                                                <th class='text-end' width="20%" >Rate</th>
                                                                <th class="d-none">TaxTypeId</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!-- Table rows will be dynamically added here -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-4">
                                        <div class="d-flex flex-wrap gap-2 justify-content-end">
                                            @if (ViewBag.BtnAuth != null)
                                            {
                                                <!-- Button Rendering Logic -->
                                                @foreach (var item in (List<Dictionary<string, object>>)ViewBag.BtnAuth)
                                                {
                                                    var btnName = item["BtnName"]?.ToString().Trim();
                                                    var btnauth = item["Auth"]?.ToString();
                                                    var icon = item["Icon"]?.ToString();
                                                    var ColorClass = item["ColorClass"]?.ToString();

                                                    if (btnauth == "Y" && !string.IsNullOrEmpty(btnName))
                                                    {
                                                        switch (btnName)
                                                        {
                                                            case "Save":
                                                                <button type="submit" id="btnSave" data-action="create" data-item-id="" class="btn @ColorClass mb-1  me-2">
                                                                    <i class="@icon"></i>@btnName
                                                                </button>
                                                                break;
                                                            case "Update":
                                                                <button id="btnUpdate" data-action="update" class="btn @ColorClass mb-1  me-2" style="display:none; ">
                                                                    <i class="@icon"></i> @btnName
                                                                </button>
                                                                break;
                                                            case "Delete":
                                                                <button type="button" id="btnDelete" data-action="create" data-item-id="" class="btn @ColorClass mb-1  me-2" style="display:none; ">
                                                                    <i class="@icon"></i>@btnName
                                                                </button>
                                                                break;
                                                            case "Reset":
                                                                <button type="reset" id="btnReset" class="btn @ColorClass mb-1   me-2">
                                                                    <i class="@icon"></i> Reset
                                                                </button>
                                                                break;
                                                            default:
                                                                break;
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                <div class="alert alert-primary" role="alert">

                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- All Tax Combinations Tab -->
                        <div class="tab-pane fade" id="all-users" role="tabpanel" aria-labelledby="all-users-tab">
                            <div class="card">
                                <div class="card-body ">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-striped   table-hover table-bordered w-100" id="Table">
                                            
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
       $(document).ready(function () {
           function Loader() {
               $(".Loader1").toggleClass('d-none');
           }
   
           var allowedVariables = [];
           //Get Dropdown Data
           {
               // GET TAX Type
               LoadDefaultTable()
              function LoadDefaultTable(){
                   $.ajax({
                       url: '@Url.Action("GETTAXSETUP", "Master")',
                       type: 'GET',
                       dataType: 'json',
                       success: function (response) {
                           if (response.length > 0) {
                               let list = "";
                               for (var i = 0; i < response.length; i++) {
                                   list += "<tr>";
                                   list += "<td  class='text-center'>" + (i + 1) + "</td>";
                                   list += `<td><center><label class="tblswitch p-0 m-0"><input type="checkbox"  value="N" name="TaxisApply" class="tbltoggleSwitch taxswitch form-control form-control-sm ">
                                              <span class="tblslider"></span>
                                         </label></center></td>`;
                                   list += "<td class='text-end TaxTypeCode'>" + response[i].TaxTypeCode + "</td>";
                                   list += "<td class='text-end TaxTypePer'>" + response[i].TaxTypePer + "</td>";
                                   list += "<td class='text-center d-none'>" + response[i].TaxTypeId + "</td>";
                                   allowedVariables.push(response[i].TaxTypeCode)
                               }
                               $("#TaxSetuptbl tbody").html(list);
                           }
                       },
                       error: function(xhr) {
                          const errorMessage = xhr.responseJSON?.error || 'Unkonwn Error';
                          Notify('error', 'Error', errorMessage);
                      }
                   });
              }

           }
           //Region logic For Tax Table Combination
           {
               $(document).on("change", ".taxswitch", function () {
                   // Initialize variables
                   var NewFormulaCode = "";
                   var NewTaxRate = 0;
                   $("#TaxSetuptbl tbody input[type='checkbox']").each(function () {
                       if ($(this).prop("checked")) {
                           var closestRow = $(this).closest("tr");
                           var TaxTypeCode = closestRow.find(".TaxTypeCode").text().trim() || "";
                           var TaxTypePer = closestRow.find(".TaxTypePer").text().trim() || 0;
                           if (NewFormulaCode !== "") {
                               NewFormulaCode += " + ";
                           }
                           NewFormulaCode += TaxTypeCode 
                           NewTaxRate += parseFloat(TaxTypePer);
                       }
                   });
                   NewTaxRate = parseFloat(NewTaxRate).toFixed(2);
                   $("#TaxFormula").val(NewFormulaCode);
                   $("#TaxCalRate").val(NewTaxRate);
               });
           }
           //Region TaxFormula VAlidations
           {
               // Region TaxFormula Validations
               $(function () {
                   $('#TaxFormula').on('input', function () {
                       // Allow only specific variables with percentages
                       $(this).val($(this).val().replace(/@@\#/g, ''));
                   });

                   $("#TaxFormula").on("change", function () {
                       var formula = $(this).val();
                       var isValid = validateFormula(formula);
                       if (isValid) {
                           $("#TaxFormula").removeClass("border border-danger")
                       } else {
                           $("#TaxFormula").addClass("border border-danger")
                       }
                   });

                   // Define allowed variables
                   function validateFormula(formula) {
                       var sanitizedFormula = formula.replace(/\bif\b|\belse\b|\belseif\b|\+\-|\-\+|\+\+|\-\-|\*\*|\/\/|&&|\|\||[+\-*\/(){}<=><]/g, ' ');
                       var variables = sanitizedFormula.trim().split(" ");
                       if (variables) {
                           for (var i = 0; i < variables.length; i++) {
                               if(variables[i] !=""){
                                   if (allowedVariables.indexOf(variables[i]) === -1) {
                                       return false; // Variable not allowed
                                   }
                               }
                           }
                       }
                       return true;
                   }
               });
           }
           //Region Add
           {
              $("#TaxCombination_Form").on("submit", function(e) {
                    e.preventDefault();

                    let isValid = true;
                    let formData = {};

                    // Collect form data
                    $(this).find("input, select, textarea").each(function() {
                        const $el = $(this);
                        const name = $el.attr('name');
                        if (name) {
                            if ($el.attr('type') === 'checkbox') {
                                formData[name] = $el.prop('checked') ? 'Y' : 'N';
                            } else {
                                formData[name] = $el.val();
                            }
                        }
                    });

                    // Validate required fields
                    const requiredFields = ["TaxCode", "TaxCalRate"];
                    requiredFields.forEach(field => {
                        if (!formData[field]) {
                            $(`#${field}`).addClass("border-danger");
                            isValid = false;
                        }
                    });

                    if (!isValid) {
                        Notify("Please fill all required fields", "", "top", "right", "fa fa-warning mr-2", "danger");
                        return;
                    }

                    // Submit the form
                    const isUpdate = $("#TaxCodeId").val() !== "";
                  const url = isUpdate ? '@Url.Action("UPDATETAXCOMBINATION", "Master")' : '@Url.Action("ADDTAXCOMBINATION", "Master")';
                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: formData,
                        success: function(response) {
                            if (response.success) {
                                AddRowdata(response.lastId);
                                $("#TaxCombination_Form")[0].reset();
                                LoadTableData();
                                HideBtn();
                               // Notify("success",response.message, "");
                            } else {
                                  Notify("error",response.message || "Operation failed", "" );
                            }
                        },
                        error: function(xhr) {
                            const errorMessage = xhr.responseJSON?.error || xhr.responseText || 'Unknown error';
                            Notify("error",errorMessage, "");
                        }
                    });
                });
           }

           //Region Update
           {
               $("#btnUpdate").click(function () {
                   let isValid = true;
                   let formData = {};
                   $("#TaxCombination_Form input,select,textarea").each(function () {
                       var inputName = $(this).attr('name').trim();
                       var inputValue = "";
                       if ($(this).find('textarea').lenght) {
                           inputValue = $(this).text();
                       } else {
                           inputValue = $(this).val();
                       }
                       var mandatoryfields = ["TaxCodeId", "TaxFormula", "TaxCalRate"];
                       var inputElement = $("#" + inputName);
                       var inputId = inputElement.attr('id');
                       var labelText = $("label[for='" + inputId + "']").text();
                       if (mandatoryfields.includes(inputName) && inputValue === "") {
                           if (inputElement.hasClass("select2-hidden-accessible")) {
                               inputElement.next('.select2-container').addClass("select2-error");
                           } else {
                               inputElement.addClass("border-danger");
                           }
                           isValid = false;
                           Notify("Please Fill " + labelText + " Details..!", "", "top", "right", "fa fa-warning mr-2", "danger", "animated fadeInRight", "animated fadeOutRight")
                           return false;
                       } else {
                           if (inputElement.hasClass("select2-hidden-accessible")) {
                               inputElement.next('.select2-container').removeClass("select2-error");
                           } else {
                               inputElement.removeClass("border-danger");
                           }
                       }
                       if (inputName !== undefined && inputName !== "" && inputName !== null) {

                           formData[inputName] = inputValue;

                       }
                   });
                   //Call Api
                   if (isValid && formData !== "") {
                       $.ajax({
                           url: '@Url.Action("UPDATETAXCOMBINATION", "Master")',
                           type: 'POST',
                           dataType: 'json',
                           data: formData,
                           success: function (response) {
                               if (response.success) {
                                   AddRowdata(response.lastId)
                                   $("#TaxCombination_Form")[0].reset();
                                   LoadTableData();
                                   HideBtn()
                                   Notify("success",response.message, "")
                               } else {
                                      Notify("error",response.message, "")
                               }
                           },
                           error: function (error) {
                                Notify("error",error, "")
                               console.error('Error:', error.responseText);
                           }
                       });
                   }
               })
           }
           //Add Row Data
           {

                   function AddRowdata(Id) {
                        var rowDataArray = []; // Better variable name than 'Array'
                        var table = "#TaxSetuptbl";

                        // Get all rows with checked checkboxes
                        $(table).find('tbody tr').each(function() {
                            var $row = $(this);
                            var $checkbox = $row.find('input[type="checkbox"]');

                            if ($checkbox.length > 0 && $checkbox.prop('checked')) {
                                var rowData = {
                                    TaxRate: $row.find('td:eq(3)').text().trim() || "",
                                    TaxTypeId: $row.find('td:eq(4)').text().trim() || "",
                                    TaxCodeFormId: $row.attr("data-tax-type-id").trim() || "",
                                    TaxCodeId: Id

                                };

                                // Only push if we have valid data
                                if (rowData.TaxRate || rowData.TaxTypeId || rowData.TaxCodeFormId) {
                                    rowDataArray.push(rowData);
                                }
                            }
                        });


                        if (rowDataArray.length === 0) {
                            Notify('warning', 'No rows selected or no valid data found', "");
                            return false;
                       }
                       console.log(rowDataArray)
                        $.ajax({
                            url: '@Url.Action("ADDFORMDT", "Master")',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(rowDataArray),
                            success: function(response) {
                                if (response.success) {
                                    Notify('success', 'Data saved successfully', "");
                                    LoadDefaultTable();
                                    return true;
                                } else {
                                    Notify('error', response.message || 'Failed to save data', "");
                                    return false;
                                }
                            },
                            error: function(error) {
                                var errorMsg = error.responseJSON?.message || error.responseText || "An unknown error occurred";
                                Notify('error', errorMsg, "");
                                console.error('Error:', error);
                            }
                        });
                    }
           }
           //Region Delete
           {
               $("#btnDelete").click(function () {
                   Delete($("#TaxCodeId").val());
               })
               $(document).on("click", ".table_delete", function () {
                   var $row = $(this).closest("tr");
                   var id = $row.find('td.tbl_Main_ID').text();
                   Delete(id);
               })
           }
           //Region Select Row Data
           {
               $(document).on("click", ".table_edit", function () {
                   var $row = $(this).closest("tr");
                     $row.addClass("active");
                   bindrecord($row)

               })
               function bindrecord($row){
                   var rowObject = {};
                   $row.find('td').each(function (index) {
                       var $td = $(this);
                       var key = $td.closest('table').find('th').eq(index).text().trim().replace(/[.,()%\- ]/g, '');
                       if ($td.find('input').length) {
                           rowObject[key] = $td.find('input').val();
                       }
                       else if ($td.find('textarea').length) {
                           rowObject[key] = $td.find('textarea').val();
                       }
                       else if ($td.find('img').length) {
                           rowObject[key] = $td.find('img').attr("src");
                       } else if ($td.find('select').length) {
                           //  rowObject[key] = $td.find('select option:selected').text().trim();
                           //  rowObject['TaxCodeval'] = $td.closest('tr').find('.Taxc option:selected').val();
                           //  rowObject['UomEntryVal'] = $td.closest('tr').find('.Uomc1 option:selected').val();
                       } else {
                           rowObject[key] = $td.text().trim();
                       }
                   });
                   $("#TaxCodeId").val(rowObject.TaxCodeId)
                   Loadrowdata(rowObject.TaxCodeId);
                   $("#TaxCode").val(rowObject.TaxCode)
                   $("#TaxFormula").val(rowObject.TaxFormula)
                   $("#TaxCalRate").val(rowObject.Rate)
                   $("#IsActive").val(rowObject.Active)
                   if (rowObject.Active == "Y") {
                       $("#IsActive").prop("checked", true);
                   }
                   if (rowObject.Active == "N") {
                       $("#IsActive").prop("checked", false);
                   }
                   $("#Freight_app").val(rowObject.Freight_app)
                   if (rowObject.Freight_app == "Y") {
                       $("#Freight_app").prop("checked", true);
                   }
                   if (rowObject.Freight_app == "N") {
                       $("#Freight_app").prop("checked", false);
                   }
                   ShowBtn()
                   $("#Create_User_Tab").click();
               }
           }
           //Function Load Row Table
           {
                         function Loadrowdata(Id) {
                            $.ajax({
                                url: '@Url.Action("GETTAXFORMDATA", "Master")',
                                type: 'GET',
                                dataType: 'json',
                                data: { Id: Id },
                                success: function(response) {

                                    if (!response || !Array.isArray(response)) {
                                        Notify('error', 'Invalid data received from server', "");
                                        return;
                                    }

                                    if (response.length === 0) {
                                        $("#TaxSetuptbl tbody").html("<tr><td colspan='6' class='text-center'>No data available</td></tr>");
                                        $("#create-tab").click();
                                        return;
                                    }

                                    let list = "";
                                    const allowedVariables = [];
                                    console.log(response)
                                    response.forEach((item, index) => {
                                        if (!item) return;

                                        const isChecked = item.Active === "Y";
                                        const taxTypePer = item.TaxTypePer ? parseFloat(item.TaxTypePer).toFixed(2) : "0.00";

                                        list += `<tr data-tax-type-id="${item.TaxCodeFormId || ''}">
                                            <td class='text-center'>${index + 1}</td>
                                            <td>
                                                <center>
                                                    <label class="tblswitch p-0 m-0">
                                                        <input type="checkbox"
                                                               ${isChecked ? 'checked' : ''}
                                                               name="TaxisApply"
                                                               data-tax-type-id="${item.TaxTypeId || ''}"
                                                               class="tbltoggleSwitch taxswitch form-control form-control-sm">
                                                        <span class="tblslider round"></span>
                                                    </label>
                                                </center>
                                            </td>
                                            <td class='text-end TaxTypeCode'>${item.TaxTypeCode || ''}</td>
                                            <td class='text-end TaxTypePer'>${taxTypePer}</td>
                                            <td class='text-center d-none TaxTypeId'>${item.TaxTypeId || ''}</td>
                                        </tr>`;

                                        if (item.TaxTypeCode) {
                                            allowedVariables.push(item.TaxTypeCode);
                                        }
                                    });

                $("#TaxSetuptbl tbody").html(list);

                // Initialize switches properly
                $('.tbltoggleSwitch').each(function() {
                    const $checkbox = $(this);
                    const isChecked = $checkbox.prop('checked');
                    $checkbox.val(isChecked ? 'Y' : 'N');

                    // Update slider appearance immediately
                    const $slider = $checkbox.next('.tblslider');
                    if (isChecked) {
                        $slider.css('background-color', '#2196F3');
                    } else {
                        $slider.css('background-color', '#ccc');
                    }
                });

                // Handle switch changes
                $('.tbltoggleSwitch').off('change').on('change', function() {
                    const isChecked = $(this).is(':checked');
                    $(this).val(isChecked ? 'Y' : 'N');

                    // Update slider appearance
                    const $slider = $(this).next('.tblslider');
                    $slider.css('background-color', isChecked ? '#2196F3' : '#ccc');

                    // You can add additional logic here
                    console.log(`TaxTypeId: ${$(this).data('tax-type-id')} changed to ${isChecked ? 'Y' : 'N'}`);
                });

                $("#create-tab").click();
            },
            error: function(error) {
                const errorMsg = error.responseJSON?.message || error.responseText || "Failed to load data";
                Notify('error', errorMsg, "");
                console.error('Error:', error);
            }
        });
    }
           }
           //Function to handle form reset
           {
               $("#btnReset").click(function () {
                   $("#TaxCodeId").val("")
                   LoadDefaultTable()
                   $(".Form_Elem").removeClass("border-danger");
               });
           }
           //Function Btn Opration
           {
               $("#btnReset").click(function () { HideBtn() })
               function ShowBtn() {
                   $("#btnDelete").show();
                   $("#btnUpdate").show();
                   $("#btnSave").hide();
               }
               function HideBtn() {
                   $("#btnSave").show();
                   $("#btnDelete").hide();
                   $("#btnUpdate").hide();
               }
           }
           //region All functions
           {
               // Function to retrieve menu data
               LoadTableData();
               function LoadTableData() {
                   $("#Table tbody").empty()
                   $.ajax({
                       url: '@Url.Action("GETTAXCOMBINATIONS", "Master")', // Update with your API endpoint for retrieving menu data
                       type: 'GET',
                       dataType: 'json',
                       success: function (response) {
                           ApplyDatatable(response, "Table")
                       },
                     error: function(xhr) {
                         const errorMessage = xhr.responseJSON?.error || 'Unkonwn Error';
                         Notify('error', 'Error', errorMessage);
                     }
                   });
               }
               //format date
               function formatAndSetDate(inputDate) {
                   const parts = inputDate.split(' ');
                   const datePart = parts[0];
                   const timePart = parts[1];
                   const [day, month, year] = datePart.split('-');
                   const formattedDate = `${year}-${month}-${day}`;
                   const formattedDateTime = `${formattedDate} ${timePart}`;
                   return formattedDate;
               }
               function SplitDatebyspace(inputDate) {
                   const parts = inputDate.split(' ');
                   return parts[0];

               }
              //Apply Datatable
         function ApplyDatatable(jsonData, Table_Id) {
             if ($.fn.DataTable.isDataTable('#' + Table_Id)) {
                 $('#' + Table_Id).DataTable().destroy();
             }
             var table = $('#' + Table_Id).DataTable({
                 data: jsonData,
                 columns: [
                     {
                         data: null,
                         title: "Sr No",
                         className: 'tbl_Sr_no no-wrap text-center',
                         render: function (data, type, row, meta) {
                             // 'meta.row' gives the index of the row
                             return meta.row + 1;
                         }
                     },
                     {
                         data: null,
                         title: 'Action',
                         className: 'text-center',
                         render: function (data, type, row) {
                             // Customize the content of the image column
                          return '<i class="bi bi-pen btn btn-outline-primary table_edit  mr-1"></i> <i class="btn btn-outline-danger bi bi-trash  mr-2  table_delete"></i>';
                         }
                     },
                     {
                         data: 'IsActive',
                         title: 'Active',
                         className: 'text-center',
                         render: function (data, type, row) {
                             // Customize the content of the image column
                             if (data == "Y") {
                                 return `<center><label style="margin:0px!important; padding:0px!important;" class="tblswitch p-0 m-0">
                                                                                 <input type="checkbox" disabled value="`+ data + `" checked name="IsActive" class="tbltoggleSwitch form-control form-control-sm ">
                                                                         <span class="tblslider"></span>
                                                                         </label></center>`;
                             } else {
                                 return `<center><label class="tblswitch">
                                                                                     <input type="checkbox" disabled value="`+ data + `"  name="IsActive" class="tbltoggleSwitch form-control form-control-sm ">
                                                                             <span class="tblslider"></span>
                                                                         </label></center>`;
                             }

                         }
                     },
                     { data: 'TaxCodeId', title: 'TaxCodeId', className: 'tbl_TaxCodeId d-none tbl_Main_ID' },
                     { data: 'TaxCode', title: 'Tax Code', className: 'tbl_CntryCode text-center' },
                     { data: 'TaxFormula', title: 'Tax Formula', className: 'tbl_TaxFormula text-center' },
                     {
                         data: 'Freight_app',
                         title: 'Freight Apply',
                         className: 'text-center',
                         render: function (data, type, row) {
                             // Customize the content of the image column
                             if (data == "Y") {
                                 return `<center><label style="margin:0px!important; padding:0px!important;" class="tblswitch p-0 m-0">
                                                                                         <input type="checkbox" disabled value="`+ data + `" checked name="Freight_app1" class="tbltoggleSwitch form-control form-control-sm ">
                                                                             <span class="tblslider"></span>
                                                                             </label></center>`;
                             } else {
                                 return `<center><label class="tblswitch">
                                                                                         <input type="checkbox" disabled value="`+ data + `"  name="Freight_app1" class="tbltoggleSwitch form-control form-control-sm ">
                                                                                 <span class="tblslider"></span>
                                                                             </label></center>`;
                             }

                         }
                     },

                     { data: 'Freight_app', title: 'Freight_app', className: 'tbl_Freight_app d-none' },
                     { data: 'TaxCalRate', title: 'Rate', className: 'tbl_TaxFormula text-right' },
                     // Add more columns as needed
                 ],
                 "columnDefs": [
                     { "targets": '_all', "className": 'dt-no-wrap' }
                 ],
                 ordering: false,
                 paging: true,
                 retrieve: true,
                 searching: true,
                 responsive: true,
                 colReorder: false,
             });
         }
               //Apply Datatable
                // function ApplyDatatable(jsonData, Table_Id) {
                //     const table = $('#' + Table_Id).DataTable({
                //         destroy: true,
                //         data: jsonData,
                //         columns: [
                //             {
                //                 data: null,
                //                 render: (data, type, row, meta) => meta.row + 1,
                //                 className: 'text-center'
                //             },
                //             {
                //                 data: null,
                //                 render: (data, type, row) => `
                //                     <i class="fa fa-edit table_edit text-primary mr-1"></i>
                //                     <i class="fa fa-trash text-danger mr-2 table_delete"></i>`,
                //                 className: 'text-center'
                //             },
                //             {
                //                 data: 'TaxCodeId',
                //                 visible: false
                //             },
                //             {
                //                 data: 'TaxCode',
                //                 className: 'text-center'
                //             },
                //             {
                //                 data: 'TaxCalRate',
                //                 className: 'text-end',
                //                 render: (data) => data ? `${data}%` : ''
                //             },
                //             {
                //                 data: 'Freight_app',
                //                 render: (data, type, row) => `
                //                     <center>
                //                         <label class="tblswitch">
                //                             <input type="checkbox" ${data === 'Y' ? 'checked' : ''}
                //                                    data-row-id="${row.TaxCodeId}" data-field="Freight_app">
                //                             <span class="tblslider"></span>
                //                         </label>
                //                     </center>`,
                //                 className: 'text-center'
                //             },
                //             {
                //                 data: 'IsActive',
                //                 render: (data, type, row) => `
                //                     <center>
                //                         <label class="tblswitch">
                //                             <input type="checkbox" ${data === 'Y' ? 'checked' : ''}
                //                                    data-row-id="${row.TaxCodeId}" data-field="IsActive">
                //                             <span class="tblslider"></span>
                //                         </label>
                //                     </center>`,
                //                 className: 'text-center'
                //             }
                //         ],
                //         responsive: true,
                //         order: [[0, 'asc']]
                      
                //     });

                //     return table; Return the table instance for further manipulation if needed
                // }

               //Delete
               function Delete(ID) {
                      $.ajax({
                            url: '@Url.Action("DELETETAXCOMBINATION", "Master")',
                            type: 'POST',
                            dataType: 'json',
                            data: { Id: ID },
                            success: function (response) {
                                if (response.success) {
                                    $("#btnReset").click();
                                    $("#TaxCombination_Form")[0].reset();
                                    LoadTableData();
                                    HideBtn()
                                    Notify("success","Deleted",response.message)
                                } else {
                                    Notify("error","","Error To Deleting Data")
                                }
                            },
                            error: function (error) {
                                 Notify("error","",error.responseText,)
                                console.error('Error:', error.responseText);
                            }
                      });
               }
           }
           // Region Navigation
           {
               var $table = $("#Table");
               $table.find("tbody tr:first").addClass("active");
               $(".btn_forward").click(function () {
                   var $currentRow = $table.find(".active");
                   var $nextRow = $currentRow.next("tr");
                   if ($nextRow.length > 0) {
                       $currentRow.removeClass("active");
                       $nextRow.addClass("active");
                       bindrecord($nextRow);
                   } else {
                       var $firstRow = $table.find("tbody tr:first");
                       $table.find(".active").removeClass("active");
                       $firstRow.addClass("active");
                       bindrecord($firstRow);

                   }
               });
               $(".btn_backward").click(function () {
                   var $currentRow = $table.find(".active");
                   var $prevRow = $currentRow.prev("tr");
                   if ($prevRow.length > 0) {
                       $currentRow.removeClass("active");
                       $prevRow.addClass("active");
                       bindrecord($prevRow);
                   } else {
                       var $lastRow = $table.find("tr:last");
                       $table.find(".active").removeClass("active");
                       $lastRow.addClass("active");
                       bindrecord($lastRow);
                   }
               });
               $(".btn_first").click(function () {
                   var $firstRow = $table.find("tbody tr:first");
                   $table.find(".active").removeClass("active");
                   $firstRow.addClass("active");
                   bindrecord($firstRow);
               });
               $(".btn_last").click(function () {
                   var $lastRow = $table.find("tr:last");
                   $table.find(".active").removeClass("active");
                   $lastRow.addClass("active");
                   bindrecord($lastRow);
               });
               $(".btn_reload").click(function () {
                   $("#TaxCombination_Form")[0].reset();
                   HideBtn()
                   $("#btnReset").click();
                   LoadDefaultTable()
               });
           }
       });
</script>

